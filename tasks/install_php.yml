---

- name: Install PHP
  apt: name={{ item }} state=present install_recommends=no update_cache=yes cache_valid_time=3600
  with_items:
    - php5
    - php5-memcached
    - php5-mysqlnd
    - php5-mcrypt
    - php5-gd
    - php5-json
    - php5-curl
  sudo: yes

- name: Install php-fpm
  apt: name=php5-fpm state=present install_recommends=no update_cache=yes cache_valid_time=3600
  when: php_type is defined and php_type == 'fpm'
  sudo: yes

- name: Configure PHP CLI
  ini_file: 
    dest=/etc/php5/cli/php.ini
    section=PHP
    option="{{ item.key }}"
    value="{{ item.value }}"
  with_dict: php_ini_cli
  sudo: yes

- name: Configure PHP server
  ini_file:
    dest="/etc/php5/{{ php_type | default('fpm') }}/php.ini"
    section=PHP
    option="{{ item.key }}"
    value="{{ item.value }}"
  with_dict: php_ini_server
  sudo: yes
  notify:
    - restart php5-server
  when: php_type is defined
